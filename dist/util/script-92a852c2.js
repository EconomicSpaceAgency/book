import{g as w,i as M}from"../web3/getMintedTokens-eba58736.js";import{r as O,s as G}from"../index-0c8d8ac8.js";import{e as D,a as j,r as H}from"../ux/revealPrice-615f876f.js";import{d as R}from"../ux/deselectPhysicalBook-f44dd0aa.js";import{b as $}from"../ux/blurAndPreventScrolling-0822e332.js";import"../provider-alchemy-0d04a0a2.js";import"../provider-jsonrpc-62e4dd44.js";import"../contract-1c37cfa4.js";import"../ux/revertTransactionInitiatedAnimation-630d6393.js";import"../ux/getColonizationLevel-f85922f9.js";let a=document.documentElement;const m=[["#222","#bbb","#fff","#b7f43d","#5d8ffc","dark"],["#bbb","#222","#000","#4510cc","#047c02","light"],["#fff","#000","#222","#3b1e84","#028c55","light"],["#b9d8e6","#58173e","#21173e","#ff5f3e","#db5cdb","light"],["#cec2af","#16164c","#4c1634","#fc3c79","#019970","light"],["#121e2b","#d9f2a7","#9e6ffc","#fc53c6","#68f738","dark"],["#23001c","#c9c9f8","#f4173e","#ffcb3e","#1c9bff","dark"],["#000","#fff","#bbb","#e2ee5c","#ee7ac7","dark"]],z=document.getElementById("bookColorButton");let N=document.getElementById("bookColorIndicator");N.innerHTML=m.length-1;const b=document.getElementsByClassName("invertOnDark");let d=0;z.onclick=function(){if(a.style.setProperty("--bg",m[d][0]),a.style.setProperty("--c1",m[d][1]),a.style.setProperty("--c2",m[d][2]),a.style.setProperty("--c3",m[d][3]),a.style.setProperty("--c4",m[d][4]),m[d][5]==="dark")for(let e=0;e<b.length;e++)b[e].style.filter="invert(1)";else for(let e=0;e<b.length;e++)b[e].style.filter="invert(0)";N.innerHTML=d,d++,d==m.length&&(d=0)};const k=[["Josefin Sans","Mazius","karrik"],["Alegreya","coconat","ignazio"],["Crimson Text","geomanist","argesta"],["Source Sans Pro","Mattone","novela"],["EB Garamond","basteleur","VG5000"]],U=document.getElementById("bookFontButton");let q=document.getElementById("bookFontIndicator"),u=0;U.onclick=function(){a.style.setProperty("--mainFontFamily",k[u][0]),a.style.setProperty("--displayFontFamily",k[u][1]),a.style.setProperty("--interfaceFontFamily",k[u][2]),q.innerHTML=u,u++,u==k.length&&(u=0)};let v=document.getElementsByClassName("footNote"),I=document.getElementsByClassName("footNoteEx"),V=1,K=new IntersectionObserver(function(e){e.forEach(function(o){let n=Array.from(v).indexOf(o.target);o.isIntersecting===!0?W(I[n],250):J(I[n],250)})},{threshold:[V]});for(let e=0;e<v.length;e++)K.observe(v[e]);const W=function(e,o){e.style.display="block",setTimeout(()=>{e.style.opacity=1},o)},J=function(e,o){e.style.opacity=0,setTimeout(()=>{e.style.display="none"},o)};let Q={Foreword:"01_Foreword.mp3","chapter-1":"02_Chapter-01_Introduction.mp3","chapter-2":"03_Chapter-02_From-capitalist-to-postcapitalist-economy.mp3","Appendix-2.1":"04_Appendix-2.1_Do-big-data-change-the-story.mp3","chapter-3":"05_Chapter-03_Markets-as-communication-networks.mp3","chapter-4":"06_Chapter-04_Production-as-performance.mp3","Appendix-4.1":"07_Appendix-4.1_A-performance-evaluation-framework.mp3","Appendix-4.2":"08_Appendix-4.2_Performances-P-and-their-outputs-C.mp3","chapter-5":"09_Chapter-05_Stake-the-key-to-value.mp3","Appendix-5.1":"10_Appendix-5.1_Fundamental-value-and-speculation-Keynes-beauty-contest.mp3","Appendix-5.2":"11_Appendix-5.2_Dividends-and-the-surplus.mp3","chapter-6":"12_Chapter-06_The-commons.mp3","chapter-7":"13_Chapter-07_Postcapitalist-units-of-measurement.mp3","chapter-8":"14_Chapter-08_Liquidity-and-credit.mp3","Appendix-8.1":"15_Appendix-8.1_Keynes-on-money-and-credit.mp3","chapter-9":"16_Chapter-09_Exchange-relations-expressed-through-tokens.mp3","Appendix-9.1":"17_Appendix-9.1_Tokens-and-network-derivatives.mp3","chapter-10":"18_Chapter-10_Tokens-and-ledgers.mp3","chapter-11":"19_Chapter-11_Dynamics-of-a-tokenised-network.mp3","chapter-12":"20_Chapter-12_Stability-volatility-and-value.mp3","Appendix-12.1":"21_Appendix-12.1_Tokenised-value-simple-and-expanded.mp3","Appendix-12.2":"22_Appendix-12.2_MV=PQ.mp3","chapter-13":"23_Chapter-13_The-conditions-of-a-digital-postcapitalist-economy.mp3"},X={root:null,rootMargin:"0px",threshold:0},Y=document.querySelectorAll(".unit"),Z=new IntersectionObserver(function(e){e.forEach(function(o){if(o.isIntersecting){let n=o.target.id,s=window.location.search;history.pushState({},"",s+"#"+n)}})},{threshold:.5});Y.forEach(function(e){Z.observe(e)});let ee=new IntersectionObserver(oe,X),te=document.querySelectorAll("[audiobookSection]");te.forEach(e=>{ee.observe(e)});function oe(e){e.forEach(o=>{if(o.isIntersecting){let n=o.target.id,s=Q[n];ne(s,n)}})}function ne(e,o){let n=document.getElementById("audioBookFile");n.paused||n.pause();let s=o.replace(/-/g," ");s=s.charAt(0).toUpperCase()+s.slice(1),document.getElementById("bookSection").innerHTML=s;let t=`audiobook/${e}`;n.src=t}const x=document.getElementById("bookBiggerFontButton"),_=document.getElementById("bookSmallerFontButton");x.onclick=function(){x.classList.contains("activeButton")?(a.style.setProperty("--bookFontSize","24px"),this.classList.remove("activeButton")):(this.classList.add("activeButton"),a.style.setProperty("--bookFontSize","28px"),_.classList.remove("activeButton"))};_.onclick=function(){_.classList.contains("activeButton")?(a.style.setProperty("--bookFontSize","24px"),this.classList.remove("activeButton")):(this.classList.add("activeButton"),a.style.setProperty("--bookFontSize","20px"),x.classList.remove("activeButton"))};const se=document.getElementById("bookIndex");buttonIndex.onclick=function(){this.classList.toggle("activeButton"),se.classList.toggle("showBookIndex")};const ie=document.getElementById("footNotesAndAudiobook");buttonFootNotes.onclick=function(){this.classList.toggle("activeButton"),ie.classList.toggle("showBookFootNotes")};function le(e,o){const n=document.createElement("span");n.textContent=e;const s=document.createElement("span");s.classList.add("tooltip");const t=document.createElement("span");t.classList.add("definition"),t.textContent=o.definition;const i=document.createElement("button");return i.classList.add("term"),s.appendChild(n),s.appendChild(i),s.appendChild(t),s.addEventListener("mouseenter",()=>{const r=s.parentElement.getBoundingClientRect(),l=i.getBoundingClientRect();l.left+l.width/2<r.left+r.width/2?(t.style.left="0",t.style.right="auto"):(t.style.left="auto",t.style.right="0")}),s}function S(e,o){if(e.classList.contains("bookGlossaryTermContainer")||e.classList.contains("excludeGlossary"))return;const n=Object.keys(o),s=new RegExp("\\b("+n.join("|")+")\\b","gi");Array.from(e.childNodes).forEach(t=>{if(t.nodeType===Node.TEXT_NODE){let i=t.textContent;const r=document.createDocumentFragment();let l;for(;(l=s.exec(i))!==null;){const g=i.slice(0,l.index);r.appendChild(document.createTextNode(g)),r.appendChild(le(l[0],o[l[0].toLowerCase()])),i=i.slice(s.lastIndex),s.lastIndex=0}r.appendChild(document.createTextNode(i)),t.parentNode.replaceChild(r,t)}else t.nodeType===Node.ELEMENT_NODE&&!t.classList.contains("tooltip")&&S(t,o)})}let T=!1,h=!1,B=!0;const ae=document.getElementById("buttonGlossary");ae.addEventListener("click",function(){if(this.classList.toggle("activeButton"),B)T||(re(),T=!0,h=!0),B=!1;else if(!B){if(h){let e=document.getElementsByClassName("tooltip"),o=document.getElementsByClassName("term");for(let n=0;n<e.length;n++)e[n].style.pointerEvents="none",o[n].style.display="none";h=!1}else if(!h){let e=document.getElementsByClassName("tooltip"),o=document.getElementsByClassName("term");for(let n=0;n<e.length;n++)e[n].style.pointerEvents="all",o[n].style.display="block";h=!0}}});function re(){fetch("glossary.json").then(e=>e.json()).then(e=>{const o=e.glossary.reduce((s,t)=>(s[t.term.toLowerCase()]={definition:t.definition,available:t.available},s),{});document.querySelectorAll(".unit").forEach(s=>{S(s,o)})}).catch(e=>console.error("Error:",e))}let p=[],f=[],C=[],c=[],ce="#",L=602;async function de(){const e=await w();fetch("glossary.json").then(o=>o.json()).then(async o=>{const n=o.glossary;n.sort((t,i)=>t.term.localeCompare(i.term));const s=document.getElementById("bookGlossary");n.forEach(t=>{const i=document.createElement("details");i.classList.add("bookGlossaryTermContainer"),i.classList.add("unit"),i.id="u"+L,L++,t.available&&i.classList.add("available");const r=document.createElement("summary");r.textContent=t.term;const l=document.createElement("p");l.textContent=" "+t.definition,i.appendChild(r),i.appendChild(l),s.appendChild(i)}),p=Array.from(document.getElementsByClassName("unit"));for(let t=0;t<p.length;t++){f[t]=document.createElement("a"),f[t].classList.add("unitNFT"),f[t].style.display="none",f[t].href=`${ce}/${t+1}`,C[t]=document.createElement("img"),C[t].src=`orbs/${t+1}.jpg`,f[t].appendChild(C[t]),p[t].prepend(f[t]),c[t]=document.createElement("button");const i=await M(t+1,e);i||c[t].classList.add("unitPublishButton"),c[t].style.display="none",c[t].id=`publishUnit${t+1}`,i?(O(t+1),G(t+1)):(c[t].innerHTML=`publish unit #${t+1}`,c[t].addEventListener("click",async function(r){try{document.getElementById("priceTierOverlay").style.display="block",document.getElementById("priceTierOverlayClose").style.display="block",document.getElementById("priceTierContent").style.display="flex",$();const l=document.getElementById("tiersErrorMessage"),g=document.getElementById("tiersSubmitButton");l&&(l.innerHTML=""),g&&(g.innerHTML="Co-publish"),D(),j(),R(),H(),localStorage.setItem("tokenId",`${t+1}`)}catch(l){console.log("Trying to handle errors with magic:",l)}})),p[t].classList.contains("available")&&p[t].append(c[t])}}).catch(o=>console.error("Error:",o))}let E=document.getElementsByClassName("unitNFT");const A=document.getElementById("map"),F=document.getElementById("toc");let y=!1;const pe=document.getElementById("bookOrbsButton");pe.onclick=function(){this.classList.toggle("activeButton"),y?(y=!1,P()):y===!1&&(y=!0,P())};de();const P=function(){if(y===!0){A.style.display="grid",F.style.display="none";for(let e=1;e<p.length;e++)p[e].style.borderBottom="1px solid var(--c2)";for(let e=1;e<E.length;e++)E[e].style.display="inline-block";for(let e=1;e<c.length;e++)c[e].style.display="inline-block"}else if(y===!1){A.style.display="none",F.style.display="block";for(let e=1;e<p.length;e++)p[e].style.borderBottom="none";for(let e=1;e<E.length;e++)E[e].style.display="none";for(let e=1;e<c.length;e++)c[e].style.display="none"}};function me(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}window.onload=function(){if(me()){const e=document.getElementById("buttonGlossary");e&&(e.style.display="none",e.disabled=!0)}};
